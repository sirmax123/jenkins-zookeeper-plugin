# zookeeper

## Introduction

Simple zookeper client.
Now implemented only 2 options: read zNode data and write data to zNode.

## Getting started


### Build
```
mvn install
```
### Deploy
On Jenkins master node copy plugin to the plugins folder

`cp target/zookeeper.hpi /var/lib/jenkins/plugins/zookeeper.hpi` 


### Use example
Simple jobe shows how to use plugin
```

def ZOOKEEPER_HOSTS = "192.168.1.223"
def date
def newZnodeData = "SomeNewData "
def preCreatedZnode = "/MyFirstZnode"
def newZnode
def dataFromZookeper
def stageName

node() {
    stageName = "Prepere variables"
    stage(stageName) {
        date = sh(script: "date", returnStdout: true)
        newZnodeData = newZnodeData + date
        newZnodeData = newZnodeData.trim()
        newZnode = "/newZnode " + date
        newZnode = newZnode.trim()
    }
    stageName = "Read data from existing node"
    stage(stageName) {
        println(stageName)
        dataFromZookeper = zookeperRead "zookeeperNodes": ZOOKEEPER_HOSTS, "znode": preCreatedZnode
        println("Got Data: " + dataFromZookeper)
        println("Write data to the zNode")
        zookeperWrite "zookeeperNodes": ZOOKEEPER_HOSTS, "znode": preCreatedZnode, "znodeData": newZnodeData
    }

    stageName = "Read data written to the zNode"
    stage(stageName) {
        println(stageName)
        dataFromZookeper = zookeperRead "zookeeperNodes": ZOOKEEPER_HOSTS, "znode": preCreatedZnode
        dataFromZookeper = dataFromZookeper.toString().trim()
        println("Got data: " + dataFromZookeper + " Expected data is: " + newZnodeData)

        if (newZnodeData.toString().trim() != dataFromZookeper.trim()) {
            println("ERROR " + newZnodeData + " != " + dataFromZookeper)
        } else {
            println("Got Expected Data: " + newZnodeData + " == " + dataFromZookeper)
        }
    }
    stageName = "Create new znode " + newZnode
    stage(stageName) {
        println(stageName)
        zookeperWrite "zookeeperNodes": ZOOKEEPER_HOSTS, "znode": newZnode, "znodeData": newZnodeData
    }
    stageName = "Read from new znode " + newZnode
    stage(stageName) {
        println(stageName)
        println(newZnode)
        dataFromZookeper = zookeperRead "zookeeperNodes": ZOOKEEPER_HOSTS, "znode": newZnode
        dataFromZookeper = dataFromZookeper.toString().trim()

        if (newZnodeData.toString().trim() != dataFromZookeper.trim()) {
            println("ERROR " + newZnodeData + " != " + dataFromZookeper)
        } else {
            println("Got Expected Data" + newZnodeData + " == " + dataFromZookeper)
        }
    }
}

```

## LICENSE
(this section is autogenerated)
Licensed under MIT, see [LICENSE](LICENSE.md)

